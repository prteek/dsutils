#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# explain: Command-line wrapper for explainshell.com

import sys
import requests
from bs4 import BeautifulSoup

def get_explanation(command):
    # URL for explainshell.com API
    url = f"http://explainshell.com/explain?cmd={command}"

    try:
        # Send a GET request to explainshell.com
        response = requests.get(url)
        response.raise_for_status()
    except requests.RequestException as e:
        print(f"Error: Unable to connect to explainshell.com: {e}")
        return None

    # Parse the response content
    soup = BeautifulSoup(response.content, "html.parser")

    # Extract explanation
    explanation_sections = soup.select("span.dropdown > a, pre")

    if not explanation_sections:
        print("No explanation found for the given command.")
        return None

    explanations = []
    for section in explanation_sections:
        text = section.get_text(strip=True)
        explanations.append(text)

    return "\n".join(explanations)

def main():
    if len(sys.argv) < 2:
        print("Usage: explain <command>")
        sys.exit(1)

    command = " ".join(sys.argv[1:])
    explanation = get_explanation(command)

    if explanation:
        print(f"Explanation for: {command}\n")
        print(explanation)

if __name__ == "__main__":
    main()
